<h1>Join a Room</h1>
<p>
  Make sure <em><i>only ONE</i></em> person from your group has selected
  <i>Start a Room</i>. That person is the Taskmaster and will lead the game.
</p>

<form
  action="./join"
  method="post"
  id="join-room-form"
  hx-on:input="console.log('form input happened');"
>
  <!-- <div
    id="join-inputs"
    hx-get="/join-continue-button"
    hx-params="*"
    hx-trigger="input changed delay:500ms"
    hx-target="#join-room-button"
    hx-swap="outerHTML"
  > -->
  <!-- Maybe a custom event instead? -->
  <div id="enter-name-section">
    <h2>Step 1: Enter Name</h2>
    <p>What is your <em>actual</em> name?</p>
    <input
      type="text"
      name="your-name"
      id="your-name"
      hx-get="/name-availability"
      hx-params="*"
      hx-trigger="input changed delay:500ms"
      hx-target="#name-availability"
      hx-swap="outerHTML"
      required
    />
    <div id="name-availability"></div>
    <br />
    <label for="your-name" id="your-name-label">Your Name</label>
    <!-- TODO: Make an Ajax request and check whether the name is valid. -->
  </div>
  <div id="join-the-room-section">
    <h2>Step 2: Join the room</h2>
    <input
      type="text"
      name="room-code"
      id="room-code"
      hx-get="/room-name"
      hx-params="*"
      hx-trigger="input changed delay:500ms"
      hx-target="#room-selected"
      hx-swap="outerHTML"
      required
    />
  </div>
  <br />
  <label for="room-code" id="room-code-label">Room Code</label>
  <div id="room-selected-section">
    <h3>Room Selected:</h3>
    <p><span id="room-selected">ðŸš« None</span></p>
  </div>
  <!-- </div> -->
  <input type="submit" id="join-room-button" value="Continue" disabled />
  <!-- TODO: Disable the button if the name is taken or the room name isn't found. -->
</form>
<div id="replace-me"></div>
<script>
  // Whenever any inputs on the form change
  const formElement = document.getElementById("join-room-form");
  formElement.addEventListener("input", (event) => {
    console.log("form input");
    const yourNameElement = document.getElementById("your-name");
    console.log("form's yourNameElement value", yourNameElement.value);
    const roomCodeElement = document.getElementById("room-code");
    console.log(
      "form's roomCodeElement value",
      document.getElementById("room-code").value
    );
    htmx.ajax("GET", "/join-continue-button", {
      // TODO: might be better as an htmx get triggered, or similar, by input
      // on the whole form, so I can de-bounce.
      target: "#join-room-button",
      swap: "outerHTML",
      values: {
        name: yourNameElement.value,
        roomCode: roomCodeElement.value,
      },
    });
  });

  // every time either text input changes, fire the "joinFormChanged" htmx custom event if the room code is valid
  // const yourNameElement = document.getElementById("your-name");
  // yourNameElement.addEventListener("input", (event) => {
  //   console.log("yourNameElement value", event.target.value);
  //   const roomCodeElement = document.getElementById("room-code");
  //   console.log("roomCodeElement value", roomCodeElement.value);
  // htmx.ajax("GET", "/join-continue-button", {
  //   values: { "not sure how": "to include multiple elements" },
  // });
  // });

  // use hx-get="/join-room-preflight" hx-trigger="joinFormChanged" to run the
  // join preflight whenever the form changes

  // server-side, have /join-room-preflight send back all three elements:
  //   - the one saying whether the name is available
  //   - the one saying whether the room is valid, and its name
  //   - the continue button, disabled or enabled based on the above

  // might be best to accomplish the above using multiple ajax calls, each one
  // returning an element with appropriate target, all triggered by the same
  // event
</script>
